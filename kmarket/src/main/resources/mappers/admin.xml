<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.kmarket.dao.AdminDAO">
    <!-- admin 상품 조회 -->
    <select id="selectProductAdmin" parameterType="kr.co.kmarket.utils.SearchCondition" resultType="kr.co.kmarket.vo.ProductVO">
        select a.*, b.uid from `km_product` as a
        join `km_member_seller` as b
        on a.seller = b.uid
        where 1=1
        <include refid="searchCondition"/>
        <include refid="sellerType2"/>
        order by `prodNo` desc
        limit #{offset}, 10;
    </select>

    <!-- 상품 조회시 전체 상품 갯수 -->
    <select id="countProductAdmin" resultType="java.lang.Integer">
        SELECT COUNT(*) FROM `km_product`
        where 1=1
        <include refid="searchCondition"/>
    </select>

    <!-- 검색 조건 -->
    <sql id="searchCondition">
        <if test="searchField != null">
            <choose>
                <when test='searchField == "prodName"'>
                    AND `prodName` LIKE CONCAT('%', #{searchWord}, '%')
                </when>
                <when test='searchField == "prodNo"'>
                    AND `prodNo` LIKE CONCAT('%', #{searchWord}, '%')
                </when>
                <when test='searchField == "seller"'>
                    AND `seller` LIKE CONCAT('%', #{searchWord}, '%')
                </when>
            </choose>
        </if>
    </sql>

    <!-- 일반적인 판매자일 경우 판매자가 등록한 상품만 조회 -->
    <sql id="sellerType2">
        <if test="type == 2">
            AND `uid` = #{uid}
        </if>
    </sql>


</mapper>